<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Create New Post - JSForum</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/highlight.js@11.7.0/lib/core.min.js"></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@11.7.0/styles/github-dark.min.css">
  <script>
    tailwind.config = {
      darkMode: 'class',
      theme: {
        extend: {
          colors: {
            discord: {
              DEFAULT: '#5865F2',
              dark: '#4752C4',
            },
            dark: {
              900: '#0a0a0a',
              800: '#1a1a1a',
              700: '#2a2a2a',
              600: '#3a3a3a',
            }
          },
          animation: {
            'fade-in': 'fadeIn 0.3s ease-in-out',
          },
          keyframes: {
            fadeIn: {
              '0%': { opacity: '0', transform: 'translateY(10px)' },
              '100%': { opacity: '1', transform: 'translateY(0)' },
            }
          }
        }
      }
    }
    
    marked.setOptions({
      highlight: function(code, lang) {
        const language = hljs.getLanguage(lang) ? lang : 'plaintext';
        return hljs.highlight(code, { language }).value;
      },
      langPrefix: 'hljs language-',
    });
  </script>
  <style type="text/tailwindcss">
    @layer utilities {
      .text-gradient {
        @apply bg-clip-text text-transparent bg-gradient-to-r from-blue-400 to-purple-600;
      }
      .bg-grid {
        background-image: radial-gradient(circle, rgba(255,255,255,0.05) 1px, transparent 1px);
        background-size: 20px 20px;
      }
      .markdown-editor {
        @apply min-h-[300px] w-full bg-dark-700 border border-dark-600 rounded-lg p-4 font-mono text-gray-200 focus:outline-none focus:ring-2 focus:ring-discord focus:border-transparent resize-y;
      }
      .markdown-toolbar {
        @apply flex flex-wrap gap-2 p-2 bg-dark-800 border border-dark-700 rounded-t-lg;
      }
      .markdown-btn {
        @apply p-2 text-gray-400 hover:text-white hover:bg-dark-700 rounded-md transition-colors;
      }
    }
  </style>
</head>
<body class="bg-dark-900 text-gray-100 min-h-screen">
  <!-- Background elements -->
  <div class="fixed inset-0 bg-grid opacity-20 -z-10"></div>
  <div class="fixed inset-0 bg-gradient-to-br from-purple-900/20 to-blue-900/20 -z-20"></div>

  <!-- Navigation -->
  <nav class="border-b border-dark-700/50 backdrop-blur-md">
    <div class="container mx-auto px-6 py-3">
      <div class="flex items-center justify-between">
        <a href="/" class="text-2xl font-bold text-gradient">JSForum</a>
        <div class="flex items-center space-x-4">
          <a href="/" class="px-4 py-2 rounded-md text-gray-300 hover:text-white hover:bg-dark-700 transition-colors">
            <i class="fas fa-arrow-left mr-2"></i> Back to Forum
          </a>
        </div>
      </div>
    </div>
  </nav>

  <!-- Main Content -->
  <main class="container mx-auto px-6 py-8 max-w-4xl">
    <div class="bg-dark-800/50 border border-dark-700 rounded-xl overflow-hidden backdrop-blur-sm animate-fade-in">
      <!-- Header -->
      <div class="border-b border-dark-700 px-6 py-4">
        <h1 class="text-2xl font-bold flex items-center">
          <i class="fas fa-plus-circle text-green-400 mr-3"></i>
          <span>Create New Post</span>
        </h1>
      </div>

      <!-- Form -->
      <form method="POST" action="/new" class="p-6">
        <!-- Title -->
        <div class="mb-6">
          <label for="title" class="block text-sm font-medium text-gray-300 mb-2">
            Post Title
          </label>
          <input type="text" id="title" name="title" required
                 class="w-full px-4 py-3 bg-dark-700 border border-dark-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-discord focus:border-transparent"
                 placeholder="What's your question or topic?">
        </div>

        <!-- Content Tabs -->
        <div class="mb-4">
          <div class="flex border-b border-dark-700">
            <button type="button" id="writeTab" class="px-4 py-2 font-medium border-b-2 border-discord text-discord">
              <i class="fas fa-edit mr-2"></i> Write
            </button>
            <button type="button" id="previewTab" class="px-4 py-2 font-medium text-gray-400 hover:text-white">
              <i class="fas fa-eye mr-2"></i> Preview
            </button>
          </div>
        </div>

        <!-- Markdown Toolbar -->
        <div class="markdown-toolbar mb-2">
          <button type="button" onclick="insertText('**','**')" class="markdown-btn" title="Bold">
            <i class="fas fa-bold"></i>
          </button>
          <button type="button" onclick="insertText('*','*')" class="markdown-btn" title="Italic">
            <i class="fas fa-italic"></i>
          </button>
          <button type="button" onclick="insertText('`','`')" class="markdown-btn" title="Code">
            <i class="fas fa-code"></i>
          </button>
          <button type="button" onclick="insertText('```\n','\n```')" class="markdown-btn" title="Code Block">
            <i class="fas fa-square-code"></i>
          </button>
          <button type="button" onclick="insertText('- ','')" class="markdown-btn" title="List">
            <i class="fas fa-list-ul"></i>
          </button>
          <button type="button" onclick="insertText('1. ','')" class="markdown-btn" title="Numbered List">
            <i class="fas fa-list-ol"></i>
          </button>
          <button type="button" onclick="insertText('[','](url)')" class="markdown-btn" title="Link">
            <i class="fas fa-link"></i>
          </button>
          <button type="button" onclick="insertText('![','](image-url)')" class="markdown-btn" title="Image">
            <i class="fas fa-image"></i>
          </button>
          <button type="button" onclick="insertText('> ','')" class="markdown-btn" title="Quote">
            <i class="fas fa-quote-right"></i>
          </button>
        </div>

        <!-- Content Area -->
        <div class="mb-6">
          <textarea id="content" name="content" required class="markdown-editor" 
                    placeholder="Write your post content here (Markdown supported)..."></textarea>
        </div>

        <!-- Preview Area -->
        <div id="previewContent" class="markdown-editor hidden"></div>

        <!-- Form Actions -->
        <div class="flex flex-wrap gap-3">
          <button type="submit" class="px-6 py-3 bg-discord hover:bg-discord-dark text-white rounded-lg font-medium transition-colors flex items-center">
            <i class="fas fa-paper-plane mr-2"></i> Publish Post
          </button>
          <button type="button" onclick="togglePreview()" id="previewBtn" class="px-6 py-3 bg-dark-700 hover:bg-dark-600 text-white rounded-lg font-medium transition-colors flex items-center">
            <i class="fas fa-eye mr-2"></i> Preview
          </button>
          <a href="/" class="px-6 py-3 bg-dark-800 hover:bg-dark-700 text-white rounded-lg font-medium transition-colors flex items-center">
            <i class="fas fa-times mr-2"></i> Cancel
          </a>
        </div>
      </form>
    </div>
  </main>

  <script>
    // Tab functionality
    const writeTab = document.getElementById('writeTab');
    const previewTab = document.getElementById('previewTab');
    const contentArea = document.getElementById('content');
    const previewContent = document.getElementById('previewContent');
    const previewBtn = document.getElementById('previewBtn');
    
    function togglePreview() {
      if (previewContent.classList.contains('hidden')) {
        // Show preview
        const raw = contentArea.value;
        const html = marked.parse(raw);
        previewContent.innerHTML = html;
        previewContent.classList.remove('hidden');
        contentArea.classList.add('hidden');
        previewTab.classList.add('border-b-2', 'border-discord', 'text-discord');
        writeTab.classList.remove('border-b-2', 'border-discord', 'text-discord');
        previewTab.classList.remove('text-gray-400', 'hover:text-white');
        writeTab.classList.add('text-gray-400', 'hover:text-white');
        previewBtn.innerHTML = '<i class="fas fa-edit mr-2"></i> Edit';
      } else {
        // Show editor
        previewContent.classList.add('hidden');
        contentArea.classList.remove('hidden');
        writeTab.classList.add('border-b-2', 'border-discord', 'text-discord');
        previewTab.classList.remove('border-b-2', 'border-discord', 'text-discord');
        writeTab.classList.remove('text-gray-400', 'hover:text-white');
        previewTab.classList.add('text-gray-400', 'hover:text-white');
        previewBtn.innerHTML = '<i class="fas fa-eye mr-2"></i> Preview';
      }
    }
    
    // Tab click handlers
    writeTab.addEventListener('click', () => {
      if (previewContent.classList.contains('hidden')) return;
      togglePreview();
    });
    
    previewTab.addEventListener('click', () => {
      if (!previewContent.classList.contains('hidden')) return;
      togglePreview();
    });
    
    // Markdown toolbar helpers
    function insertText(before, after) {
      const textarea = document.getElementById('content');
      const start = textarea.selectionStart;
      const end = textarea.selectionEnd;
      const selectedText = textarea.value.substring(start, end);
      const beforeText = textarea.value.substring(0, start);
      const afterText = textarea.value.substring(end);
      
      textarea.value = beforeText + before + selectedText + after + afterText;
      
      // Set cursor position
      if (selectedText.length > 0) {
        textarea.selectionStart = start + before.length;
        textarea.selectionEnd = end + before.length;
      } else {
        textarea.selectionStart = textarea.selectionEnd = start + before.length;
      }
      
      textarea.focus();
    }
    
    // Initialize tabs
    writeTab.classList.add('border-b-2', 'border-discord', 'text-discord');
  </script>
</body>
</html>